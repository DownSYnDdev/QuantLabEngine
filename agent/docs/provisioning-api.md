Provisioning API
Version: 1.0.0
Scope: Defines how external systems (prop‑firm websites, admin dashboards, automation tools) provision, update, and version trading accounts within QuantLab.
The provisioning API is the authoritative interface for:
- Creating new accounts
- Updating account metadata
- Applying config versions
- Validating tenant‑specific rules
- Ensuring audit‑log and rule‑engine consistency
This API is tenant‑scoped, HMAC‑authenticated, and fully stateless.

1. Provisioning Flow Overview
Provisioning follows a strict sequence:
- Website selects account type
(e.g., 25k-eval, 50k-straight-through)
- Website selects config version
(e.g., 1.0.0)
- Website sends POST /accounts
with tenant ID + HMAC signature
- QuantLab validates:
- Tenant exists
- Config version exists
- Account type allowed for tenant
- Config schema is valid
- Rule‑engine version is compatible
- Account is created
- Assigned unique accountId
- Initial balance/equity set
- Rule‑engine state initialized
- Event emitted:
account.provisioned
- Audit log entry written

2. Provisioning Endpoint
POST /api/v1/tenants/{tenantId}/accounts
Creates a new trading account.
Request Body
{
  "accountType": "25k-eval",
  "configVersion": "1.0.0",
  "userId": "12345"
}


Validation Rules
|  |  | 
|  |  | 
|  | /configs/accounts/ | 
|  |  | 
|  |  | 
|  |  | 


Response
{
  "accountId": "25k-eval-v1",
  "status": "provisioned",
  "configVersion": "1.0.0"
}


Events Emitted
- account.provisioned
Audit Log
Stored under:
/audit/{tenantId}/{accountId}/YYYY/MM/DD/events.jsonl



3. Config Versioning
QuantLab supports immutable versioned configs.
Config Version Rules
- Versions are stored under:
agent/configs/accounts/{accountType}/{version}.json
- Versions cannot be modified after creation
- New versions must increment semver
- Accounts reference config versions explicitly
- Rule‑engine version is tied to config version
Example Config Snippet
{
  "version": "1.0.0",
  "initialBalance": 25000,
  "allowedInstruments": ["EURUSD", "XAUUSD"],
  "dailyLossLimit": 500,
  "maxLossLimit": 1250,
  "ruleEngineVersion": "1.0.0"
}



4. Updating Accounts
POST /api/v1/tenants/{tenantId}/accounts/{accountId}
Used to update metadata or config version.
Request Body
{
  "configVersion": "1.0.1",
  "status": "paused"
}


Allowed Updates
|  |  |  | 
| configVersion |  |  | 
| status |  | activepausedclosed | 
| balance/equity |  |  | 
| metrics |  |  | 


Response
{
  "accountId": "25k-eval-v1",
  "updated": true
}


Events Emitted
- account.updated

5. Tenant‑Aware Provisioning Rules
Tenant configs define:
- Allowed account types
- Allowed config versions
- Webhook secrets
- Branding
- Data provider settings
Example Tenant Config
{
  "tenantId": "tenantA",
  "allowedAccountTypes": ["25k-eval", "50k-eval"],
  "allowedConfigVersions": ["1.0.0", "1.0.1"],
  "webhookSecret": "abc123",
  "branding": {
    "name": "Alpha Funding",
    "primaryColor": "#1A73E8"
  }
}


Provisioning checks these constraints before creating an account.

6. Validation Pipeline
Provisioning uses a multi‑stage validation pipeline:
6.1 Schema Validation
- Ensures config JSON matches schema
- Ensures required fields exist
- Ensures rule‑engine fields are present
6.2 Rule‑Engine Compatibility
- Ensures config references a valid rule‑engine version
- Ensures rule‑engine skill stubs exist
6.3 Tenant Constraints
- Allowed account types
- Allowed config versions
- Tenant‑specific overrides
6.4 Simulation Engine Initialization
- Sets initial balance
- Initializes metrics
- Creates empty position list

7. Error Codes
|  |  | 
| 400 |  | 
| 401 |  | 
| 403 |  | 
| 404 |  | 
| 409 |  | 
| 422 |  | 
| 500 |  | 



8. Events Generated by Provisioning
|  |  | 
| account.provisioned |  | 
| account.updated |  | 
| rule.violation.* |  | 
| webhook.* |  | 



9. Changelog
1.0.0 — Initial release covering:
- Account provisioning
- Config versioning
- Tenant‑aware validation
- Update endpoint
- Event + audit‑log integration
